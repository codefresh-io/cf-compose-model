version: '1.0'
steps:

  build_image:
    title: Builder image ...
    type: build
    image_name: codefreshio/cfcomposemodel

  push_to_registry:
    title: Pushing to registry...
    type: push
    candidate: '${{build_image}}'
    tag: '${{CF_BRANCH}}'

  deploy_to_npm:
    title: Publishing To Npm
    image: '${{build_image}}'
    working_directory: IMAGE_WORK_DIR
    entry_point:
      - /bin/sh
      - /codefresh/volume/cf-generated/deploy_script
    create_file:
      path: /codefresh/volume/cf-generated
      name: deploy_script
      content: npm run ci-publish
    when:
      branch:
        only: [ master ]
